{% extends 'base_dashboard.html' %}

{% block title %}Dashboard - Finanpy{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Stats Cards Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">

    <!-- Card: Saldo Total -->
    <div class="bg-gray-900 border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
            <span class="text-sm font-medium text-gray-400">Saldo Total</span>
            <div class="w-10 h-10 rounded-lg bg-cyan-500/10 flex items-center justify-center">
                <svg class="w-5 h-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                </svg>
            </div>
        </div>
        <p class="text-2xl font-bold text-gray-100">
            R$ {{ total_balance|floatformat:2 }}
        </p>
        <p class="text-xs text-gray-500 mt-1">Todas as contas</p>
    </div>

    <!-- Card: Receitas do Mês -->
    <div class="bg-gray-900 border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
            <span class="text-sm font-medium text-gray-400">Receitas do Mês</span>
            <div class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                <svg class="w-5 h-5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" />
                </svg>
            </div>
        </div>
        <p class="text-2xl font-bold text-emerald-400">
            R$ {{ monthly_income|floatformat:2 }}
        </p>
        <p class="text-xs text-gray-500 mt-1">Entradas neste mês</p>
    </div>

    <!-- Card: Despesas do Mês -->
    <div class="bg-gray-900 border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
            <span class="text-sm font-medium text-gray-400">Despesas do Mês</span>
            <div class="w-10 h-10 rounded-lg bg-red-500/10 flex items-center justify-center">
                <svg class="w-5 h-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6L9 12.75l4.286-4.286a11.948 11.948 0 014.306 6.43l.776 2.898m0 0l3.182-5.511m-3.182 5.51l-5.511-3.181" />
                </svg>
            </div>
        </div>
        <p class="text-2xl font-bold text-red-400">
            R$ {{ monthly_expenses|floatformat:2 }}
        </p>
        <p class="text-xs text-gray-500 mt-1">Saídas neste mês</p>
    </div>

    <!-- Card: Balanço do Mês -->
    <div class="bg-gray-900 border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
            <span class="text-sm font-medium text-gray-400">Balanço do Mês</span>
            <div class="w-10 h-10 rounded-lg bg-cyan-500/10 flex items-center justify-center">
                <svg class="w-5 h-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                </svg>
            </div>
        </div>
        <p class="text-2xl font-bold {% if monthly_balance >= 0 %}text-emerald-400{% else %}text-red-400{% endif %}">
            R$ {{ monthly_balance|floatformat:2 }}
        </p>
        <p class="text-xs text-gray-500 mt-1">Receitas - Despesas</p>
    </div>

</div>

<!-- Bottom Section: Transactions + Accounts -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- Últimas Transações (2/3 width on desktop) -->
    <div class="lg:col-span-2 bg-gray-900 border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-gray-100">Últimas Transações</h3>
            <a href="{% url 'transactions:list' %}"
               class="text-sm text-cyan-400 hover:text-cyan-300 transition-colors">
                Ver todas
            </a>
        </div>

        {% if recent_transactions %}
            <div class="space-y-3">
                {% for transaction in recent_transactions %}
                <div class="flex items-center justify-between py-3 border-b border-gray-800 last:border-b-0">
                    <div class="flex items-center space-x-3">
                        <div class="w-9 h-9 rounded-lg flex items-center justify-center
                                    {% if transaction.transaction_type == 'income' %}
                                        bg-emerald-500/10
                                    {% else %}
                                        bg-red-500/10
                                    {% endif %}">
                            {% if transaction.transaction_type == 'income' %}
                                <svg class="w-4 h-4 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25" />
                                </svg>
                            {% else %}
                                <svg class="w-4 h-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 4.5l15 15m0 0V8.25m0 11.25H8.25" />
                                </svg>
                            {% endif %}
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-200">
                                {{ transaction.description|default:"Sem descrição" }}
                            </p>
                            <p class="text-xs text-gray-500">
                                {{ transaction.category.name|default:"Sem categoria" }} &middot; {{ transaction.date|date:"d/m/Y" }}
                            </p>
                        </div>
                    </div>
                    <span class="text-sm font-semibold
                                 {% if transaction.transaction_type == 'income' %}
                                     text-emerald-400
                                 {% else %}
                                     text-red-400
                                 {% endif %}">
                        {% if transaction.transaction_type == 'income' %}+{% else %}-{% endif %}
                        R$ {{ transaction.amount|floatformat:2 }}
                    </span>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="flex flex-col items-center justify-center py-12 text-center">
                <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mb-4">
                    <svg class="w-6 h-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                </div>
                <p class="text-sm text-gray-500 mb-1">Nenhuma transação registrada</p>
                <p class="text-xs text-gray-600">Suas transações mais recentes aparecerão aqui.</p>
            </div>
        {% endif %}
    </div>

    <!-- Saldos por Conta (1/3 width on desktop) -->
    <div class="bg-gray-900 border border-gray-800 rounded-xl p-6">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-gray-100">Contas</h3>
            <a href="{% url 'accounts:list' %}"
               class="text-sm text-cyan-400 hover:text-cyan-300 transition-colors">
                Ver todas
            </a>
        </div>

        {% if accounts %}
            <div class="space-y-4">
                {% for account in accounts %}
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 rounded-full" style="background-color: {{ account.color }};"></div>
                        <div>
                            <p class="text-sm font-medium text-gray-200">{{ account.name }}</p>
                            <p class="text-xs text-gray-500">{{ account.get_account_type_display }}</p>
                        </div>
                    </div>
                    <span class="text-sm font-semibold text-gray-100">
                        R$ {{ account.balance|floatformat:2 }}
                    </span>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="flex flex-col items-center justify-center py-12 text-center">
                <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mb-4">
                    <svg class="w-6 h-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                    </svg>
                </div>
                <p class="text-sm text-gray-500 mb-1">Nenhuma conta cadastrada</p>
                <p class="text-xs text-gray-600">Cadastre suas contas para acompanhar os saldos.</p>
            </div>
        {% endif %}
    </div>

</div>
{% endblock %}
